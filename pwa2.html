<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progressive Web Apps - Chapter 2: Service Workers</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin-top: 10px;
        }
        .content {
            padding: 40px;
        }
        .section {
            margin-bottom: 40px;
        }
        .section h2 {
            color: #4285f4;
            border-bottom: 3px solid #4285f4;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        .section h3 {
            color: #34a853;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
        }
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        .important {
            background: #f8d7da;
            padding: 15px;
            border-left: 4px solid #dc3545;
            margin: 20px 0;
        }
        .lifecycle-diagram {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .lifecycle-step {
            display: inline-block;
            background: #4285f4;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            margin: 5px;
            font-size: 0.9em;
        }
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .strategy-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }
        .strategy-card h4 {
            color: #4285f4;
            margin: 0 0 10px 0;
        }
        .strategy-card p {
            margin: 0;
            color: #666;
            font-size: 0.9em;
        }
        .quiz-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
        }
        .quiz-section h3 {
            color: #333;
            margin-bottom: 20px;
        }
        .quiz-question {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .quiz-question h4 {
            color: #4285f4;
            margin: 0 0 15px 0;
        }
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .quiz-option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .quiz-option:hover {
            background: #e3f2fd;
            border-color: #4285f4;
        }
        .quiz-option.correct {
            background: #e8f5e9;
            border-color: #34a853;
        }
        .quiz-option.incorrect {
            background: #ffebee;
            border-color: #dc3545;
        }
        .quiz-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            display: none;
        }
        .quiz-result.correct {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .quiz-result.incorrect {
            background: #ffebee;
            color: #c62828;
        }
        .navigation {
            background: linear-gradient(135deg, #fff8e1 0%, #ffcc02 100%);
            border: 2px solid #ff9800;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
        }
        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .nav-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }
        .nav-btn:hover {
            background: #3367d6;
        }
        .nav-btn.secondary {
            background: #34a853;
        }
        .nav-btn.secondary:hover {
            background: #2e7d32;
        }
        .practice-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .practice-section h4 {
            color: #4285f4;
            margin: 0 0 15px 0;
        }
        .practice-list {
            list-style: none;
            padding: 0;
        }
        .practice-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .practice-list li:before {
            content: "üîß ";
            margin-right: 8px;
        }
        .event-flow {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .event-flow h4 {
            color: #1976d2;
            margin: 0 0 15px 0;
        }
        .event-step {
            background: white;
            border: 1px solid #bbdefb;
            border-radius: 6px;
            padding: 10px;
            margin: 5px 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì± Progressive Web Apps</h1>
            <div class="subtitle">Chapter 2: Service Workers</div>
        </div>

        <div class="content">
            <div class="section">
                <h2>üîß What are Service Workers?</h2>
                <p>Service workers are JavaScript files that run in the background, separate from the main browser thread. They act as a programmable network proxy, enabling features like offline functionality, background sync, and push notifications.</p>

                <div class="highlight">
                    <strong>Key Characteristics:</strong>
                    <ul>
                        <li><strong>Event-driven</strong> - Respond to events like network requests and push messages</li>
                        <li><strong>Asynchronous</strong> - Non-blocking operations that don't interfere with the main thread</li>
                        <li><strong>Background execution</strong> - Continue running even when the page is closed</li>
                        <li><strong>HTTPS only</strong> - Must be served over HTTPS for security</li>
                        <li><strong>Scope-limited</strong> - Only control pages within their defined scope</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <h2>üìã Service Worker Lifecycle</h2>

                <div class="lifecycle-diagram">
                    <div class="lifecycle-step">üìù Registration</div>
                    <div class="lifecycle-step">‚¨áÔ∏è</div>
                    <div class="lifecycle-step">‚öôÔ∏è Installing</div>
                    <div class="lifecycle-step">‚¨áÔ∏è</div>
                    <div class="lifecycle-step">‚úÖ Installed</div>
                    <div class="lifecycle-step">‚¨áÔ∏è</div>
                    <div class="lifecycle-step">üéØ Activating</div>
                    <div class="lifecycle-step">‚¨áÔ∏è</div>
                    <div class="lifecycle-step">üöÄ Activated</div>
                    <div class="lifecycle-step">‚¨áÔ∏è</div>
                    <div class="lifecycle-step">üóëÔ∏è Redundant</div>
                </div>

                <h3>1. Registration</h3>
                <p>The first step is registering the service worker in your main JavaScript file.</p>

                <div class="code-block">
                    <pre><code>// Register service worker
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js')
        .then(function(registration) {
            console.log('Service Worker registered successfully:', registration.scope);

            // Check for updates
            registration.addEventListener('updatefound', function() {
                const newWorker = registration.installing;
                console.log('New service worker found');
            });
        })
        .catch(function(error) {
            console.log('Service Worker registration failed:', error);
        });
}</code></pre>
                </div>

                <h3>2. Installation</h3>
                <p>The install event is fired when the service worker is first downloaded or when an update is available.</p>

                <div class="code-block">
                    <pre><code>// Service Worker Installation
self.addEventListener('install', function(event) {
    console.log('Service Worker installing.');

    // Pre-cache important resources
    event.waitUntil(
        caches.open('my-app-cache-v1')
            .then(function(cache) {
                return cache.addAll([
                    '/',
                    '/index.html',
                    '/styles.css',
                    '/app.js',
                    '/manifest.json'
                ]);
            })
    );

    // Force activation (skip waiting)
    self.skipWaiting();
});</code></pre>
                </div>

                <h3>3. Activation</h3>
                <p>The activate event is fired when the service worker becomes active and can control pages.</p>

                <div class="code-block">
                    <pre><code>// Service Worker Activation
self.addEventListener('activate', function(event) {
    console.log('Service Worker activating.');

    // Clean up old caches
    event.waitUntil(
        caches.keys().then(function(cacheNames) {
            return Promise.all(
                cacheNames.map(function(cacheName) {
                    if (cacheName !== 'my-app-cache-v1') {
                        console.log('Deleting old cache:', cacheName);
                        return caches.delete(cacheName);
                    }
                })
            );
        })
    );

    // Take control of all clients
    self.clients.claim();
});</code></pre>
                </div>
            </div>

            <div class="section">
                <h2>üíæ Caching Strategies</h2>

                <div class="strategy-grid">
                    <div class="strategy-card">
                        <h4>üì¶ Cache First</h4>
                        <p>Serve from cache first, fall back to network. Best for static assets that don't change often.</p>
                    </div>

                    <div class="strategy-card">
                        <h4>üåê Network First</h4>
                        <p>Try network first, fall back to cache. Best for dynamic content that needs to be fresh.</p>
                    </div>

                    <div class="strategy-card">
                        <h4>‚ö° Stale While Revalidate</h4>
                        <p>Serve from cache immediately, then update from network in background. Best for balance of speed and freshness.</p>
                    </div>

                    <div class="strategy-card">
                        <h4>üîÑ Cache Only</h4>
                        <p>Serve only from cache. Useful for offline-only resources.</p>
                    </div>

                    <div class="strategy-card">
                        <h4>üåç Network Only</h4>
                        <p>Always fetch from network. Useful for analytics or non-cacheable content.</p>
                    </div>

                    <div class="strategy-card">
                        <h4>üéØ Race Condition</h4>
                        <p>Request from both cache and network, use whichever responds first.</p>
                    </div>
                </div>

                <h3>Implementing Cache Strategies</h3>

                <div class="code-block">
                    <pre><code>// Cache First Strategy
self.addEventListener('fetch', function(event) {
    event.respondWith(
        caches.match(event.request)
            .then(function(response) {
                // Return cached version or fetch from network
                return response || fetch(event.request);
            })
    );
});

// Network First Strategy
self.addEventListener('fetch', function(event) {
    event.respondWith(
        fetch(event.request)
            .then(function(response) {
                // Cache the fresh response
                if (response.status === 200) {
                    const responseClone = response.clone();
                    caches.open('my-app-cache-v1')
                        .then(function(cache) {
                            cache.put(event.request, responseClone);
                        });
                }
                return response;
            })
            .catch(function() {
                // Network failed, try cache
                return caches.match(event.request);
            })
    );
});

// Stale While Revalidate Strategy
self.addEventListener('fetch', function(event) {
    event.respondWith(
        caches.match(event.request)
            .then(function(response) {
                const fetchPromise = fetch(event.request)
                    .then(function(networkResponse) {
                        if (networkResponse.status === 200) {
                            caches.open('my-app-cache-v1')
                                .then(function(cache) {
                                    cache.put(event.request, networkResponse.clone());
                                });
                        }
                        return networkResponse;
                    });

                // Return cached version immediately, update in background
                return response || fetchPromise;
            })
    );
});</code></pre>
                </div>
            </div>

            <div class="section">
                <h2>üîÑ Background Sync</h2>
                <p>Background sync allows your PWA to defer actions until the user has stable connectivity, ensuring important tasks are completed even when offline.</p>

                <div class="code-block">
                    <pre><code>// Register background sync
function registerBackgroundSync() {
    if ('serviceWorker' in navigator && 'sync' in window.ServiceWorkerRegistration.prototype) {
        navigator.serviceWorker.ready
            .then(function(registration) {
                return registration.sync.register('background-sync');
            })
            .then(function() {
                console.log('Background sync registered');
            })
            .catch(function(error) {
                console.log('Background sync registration failed');
            });
    }
}

// In service worker, handle sync events
self.addEventListener('sync', function(event) {
    if (event.tag === 'background-sync') {
        event.waitUntil(doBackgroundSync());
    }
});

function doBackgroundSync() {
    // Perform background tasks like:
    // - Sending queued requests
    // - Uploading files
    // - Syncing data with server
    return fetch('/api/sync')
        .then(function(response) {
            return response.json();
        })
        .then(function(data) {
            console.log('Background sync completed:', data);
        });
}</code></pre>
                </div>
            </div>

            <div class="section">
                <h2>üîî Push Notifications</h2>
                <p>Push notifications allow your PWA to send messages to users even when the app isn't open.</p>

                <div class="code-block">
                    <pre><code>// Request permission for notifications
function requestNotificationPermission() {
    if ('Notification' in window && navigator.serviceWorker) {
        Notification.requestPermission()
            .then(function(permission) {
                if (permission === 'granted') {
                    console.log('Notification permission granted');
                    subscribeToPushNotifications();
                }
            });
    }
}

// Subscribe to push notifications
function subscribeToPushNotifications() {
    navigator.serviceWorker.ready
        .then(function(registration) {
            const vapidPublicKey = 'YOUR_VAPID_PUBLIC_KEY';
            return registration.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: urlBase64ToUint8Array(vapidPublicKey)
            });
        })
        .then(function(subscription) {
            console.log('Push subscription:', subscription);
            // Send subscription to your server
            return fetch('/api/subscribe', {
                method: 'POST',
                body: JSON.stringify(subscription),
                headers: {
                    'Content-Type': 'application/json'
                }
            });
        });
}

// Handle push events in service worker
self.addEventListener('push', function(event) {
    const options = {
        body: event.data ? event.data.text() : 'New notification',
        icon: '/icon-192x192.png',
        badge: '/badge-72x72.png',
        vibrate: [100, 50, 100],
        data: {
            dateOfArrival: Date.now(),
            primaryKey: 1
        },
        actions: [
            {
                action: 'explore',
                title: 'Explore',
                icon: '/explore-icon.png'
            },
            {
                action: 'close',
                title: 'Close',
                icon: '/close-icon.png'
            }
        ]
    };

    event.waitUntil(
        self.registration.showNotification('My PWA', options)
    );
});

// Handle notification clicks
self.addEventListener('notificationclick', function(event) {
    event.notification.close();

    if (event.action === 'explore') {
        // Handle explore action
        event.waitUntil(
            clients.openWindow('/explore')
        );
    } else {
        // Handle default click
        event.waitUntil(
            clients.openWindow('/')
        );
    }
});</code></pre>
                </div>
            </div>

            <div class="section">
                <h2>üéØ Best Practices</h2>

                <div class="important">
                    <strong>Security Considerations:</strong>
                    <ul>
                        <li>Always serve service workers over HTTPS</li>
                        <li>Use appropriate cache strategies for sensitive data</li>
                        <li>Validate push notification payloads</li>
                        <li>Handle errors gracefully</li>
                    </ul>
                </div>

                <div class="highlight">
                    <strong>Performance Tips:</strong>
                    <ul>
                        <li>Cache only essential resources during installation</li>
                        <li>Use appropriate cache strategies for different resource types</li>
                        <li>Implement cache versioning for updates</li>
                        <li>Monitor cache usage and clean up old caches</li>
                        <li>Use background sync sparingly to avoid battery drain</li>
                    </ul>
                </div>

                <div class="practice-section">
                    <h4>üõ†Ô∏è Practice Exercises</h4>
                    <ul class="practice-list">
                        <li>Implement a cache-first strategy for static assets</li>
                        <li>Create a network-first strategy for API calls</li>
                        <li>Set up background sync for form submissions</li>
                        <li>Implement push notification subscription</li>
                        <li>Handle service worker updates gracefully</li>
                        <li>Test offline functionality using browser dev tools</li>
                    </ul>
                </div>
            </div>

            <div class="quiz-section">
                <h3>üìù Knowledge Check</h3>

                <div class="quiz-question">
                    <h4>1. What is the correct order of service worker lifecycle events?</h4>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">Install ‚Üí Activate ‚Üí Register</div>
                        <div class="quiz-option" data-correct="true">Register ‚Üí Install ‚Üí Activate</div>
                        <div class="quiz-option" data-correct="false">Activate ‚Üí Register ‚Üí Install</div>
                        <div class="quiz-option" data-correct="false">Register ‚Üí Activate ‚Üí Install</div>
                    </div>
                    <div class="quiz-result" id="result1"></div>
                </div>

                <div class="quiz-question">
                    <h4>2. Which caching strategy serves cached content first, then updates in the background?</h4>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">Cache First</div>
                        <div class="quiz-option" data-correct="false">Network First</div>
                        <div class="quiz-option" data-correct="true">Stale While Revalidate</div>
                        <div class="quiz-option" data-correct="false">Network Only</div>
                    </div>
                    <div class="quiz-result" id="result2"></div>
                </div>

                <div class="quiz-question">
                    <h4>3. What method is used to register a background sync event?</h4>
                    <div class="quiz-options">
                        <div class="quiz-option" data-correct="false">navigator.sync.register()</div>
                        <div class="quiz-option" data-correct="true">registration.sync.register()</div>
                        <div class="quiz-option" data-correct="false">self.sync.register()</div>
                        <div class="quiz-option" data-correct="false">window.sync.register()</div>
                    </div>
                    <div class="quiz-result" id="result3"></div>
                </div>
            </div>

            <div class="navigation">
                <h3>üìö Chapter Navigation</h3>
                <p>Continue your PWA learning journey:</p>

                <div class="nav-buttons">
                    <a href="pwa1.html" class="nav-btn secondary">‚¨ÖÔ∏è PWA Fundamentals</a>
                    <a href="pwa3.html" class="nav-btn">App Manifest ‚û°Ô∏è</a>
                    <a href="study-guide-progress.html" class="nav-btn secondary">üìä Progress Dashboard</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Quiz functionality
        document.addEventListener('DOMContentLoaded', function() {
            const quizOptions = document.querySelectorAll('.quiz-option');

            quizOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const question = this.parentElement.parentElement;
                    const options = question.querySelectorAll('.quiz-option');
                    const resultDiv = question.querySelector('.quiz-result');
                    const questionNumber = question.querySelector('h4').textContent.split('.')[0];

                    // Remove previous selections
                    options.forEach(opt => {
                        opt.classList.remove('correct', 'incorrect');
                    });

                    // Check answer
                    const isCorrect = this.getAttribute('data-correct') === 'true';

                    if (isCorrect) {
                        this.classList.add('correct');
                        resultDiv.textContent = '‚úÖ Correct! Well done.';
                        resultDiv.className = 'quiz-result correct';
                    } else {
                        this.classList.add('incorrect');
                        resultDiv.textContent = '‚ùå Incorrect. Try again!';
                        resultDiv.className = 'quiz-result incorrect';
                    }

                    resultDiv.style.display = 'block';
                });
            });
        });

        // Utility function for VAPID key conversion
        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding)
                .replace(/-/g, '+')
                .replace(/_/g, '/');

            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);

            for (let i = 0; i < rawData.length; ++i) {
                outputArray[i] = rawData.charCodeAt(i);
            }
            return outputArray;
        }
    </script>
</body>
</html></content>
<parameter name="filePath">c:\Users\Admin\Sunil\Study\pwa2.html